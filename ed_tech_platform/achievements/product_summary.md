# プロダクト開発

## 繁忙期のCX改善施策
特定の時期に利用が集中する重要な機能に対し、顧客体験向上及び、サービスオンボーディングに寄与する改善施策を行いました。

### やった事
#### データマイニング/課題洗い出し
過去のお問合せ履歴、アプリケーションログ、DBデータを分析して課題を抽出し、プロダクトに対する改善点の洗い出しを行いました。

#### 仮説の選定

データサイエンティスト、エンジニアリーダーに相談を重ね確度向上を図りながら、工数、効果期待値、計測容易性、インシデントレベルなどを基に効果的な施策を決定しました。

以下に例を何点か挙げます。

* CI並列化(改善のサイクルを早める為)
* パフォーマンス改善
* サーバー必要台数の検討、増加
* バグ修正
* エラーメッセージ変更

例えば、パフォーマンス改善は以下の改善を行いました。

##### 問題
処理時間が遅くタイムアウトが多発している処理がある。

##### 影響
ユーザーのサービス活用フローが先に進まない。
多くの問い合わせに繋がっている。
ユーザーのモチベーションを著しく下げているだろうと仮説をたてました。

##### 原因
検証環境の最大想定時間が100秒を超えているものの、以下の原因から改善がされていない状況でした。
* テストが無い(カバレッジ0)
* 複雑な処理
  * 1メソッドで350行超え
  * カリー化された関数が多様
  * 特異メソッドの使用
  * コールバック多様
  * 30弱の定数
  * Refinementsの使用

##### 対応
2週間で処理時間50%削減かつデグレートなしを目標に
以下の対応行い100秒の処理が45秒に55%の処理時間削減に成功しました。

* UTテスト追加(カバレッジ0から90)
* リファクタ
* 再設計
* N+1解消

##### 検証

BIツールTableauを使用し施策の指数を可視化し効果検証を行いました。
この問題起因のCXについては前年度の繁忙期比で以下の改善を達成しました。

* エラー発生回数50回 -> 1回
* お問合せは25回 -> 1回

また、繁忙期の初めにサーバの増加台数の不足が分かり原因、対策を振り返りました。

## 特定機能の運用負荷軽減

特定の機能でコードの複雑性、社内知見の不足により、開発/運用負荷が高く組織が疲弊している課題がありました。
(調査にエンジニアのリソースが1週間消費される事もあったと聞いていました)
また課題感の共通認識はあったものの、具体的な対応は何もされていない状態が続いていました。
そこで、運用体制を決定し実行するまでをファシリテートしました。

### やった事

お問合せ体制を以下の様に変更し対応不可の軽減を行いました。

* お問合せ調査は1人をslackのランダムbotで決定する
* botで指定されたメンバーと私の2人でペアで調査 - リリースまで行う。

大きな狙いは、ペアで行う事での対メンバーへの負荷軽減とナレッジの共有です。

合わせて、コードの複雑度を下げる改善を行いました。
テストコードが存在しないかつ、非常に複雑なコードだった為、
大きな改善後にバグ発生する可能性がある事をCTOに説明した上で合意を頂き対応しました。

* ローカル環境で開発できなかった部分を開発可能にした
* デッドコードの削除
* リファクタリング
  * 1700行の巨大クラスに集約されていた処理をを責務毎にクラス抽出。その後、巨大クラスを削除
  * 合計5000行を削除

### 結果
実際にいくつかバグは発生してしまいましたが、非常に短い時間で修正しました。
改善後は調査に数日を要するお問合せ対応は発生していません。
また、運用負荷が非常に下がり組織の疲弊も解消されました。

## 外部API仕様変更によるリプレイス

実装は外部ベンダーが対応していたので、コードレビューやアーキテクチャの選定を行いました。
外部APIのスタブを以下の技術を採用し、サーバレスで素早く作成する事で開発スピードの向上に貢献しました。

* CloudFormation
* ApiGeteway
* lambda(Ruby)
* Sinatra
